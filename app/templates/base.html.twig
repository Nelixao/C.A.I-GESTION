<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Sistema de Reportes{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ asset('css/stylos.css') }}">
    <!-- CSS de Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- JavaScript de Bootstrap con Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    {% block stylesheets %}{% endblock %}
    {% block javascripts %}{% endblock %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        function normalize(s){return (s||'').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');}
        document.querySelectorAll('.js-table-toolbar').forEach(function(toolbar){
          const wrapper = toolbar.closest('.js-table-wrapper');
          if(!wrapper) return;
          const table = wrapper.querySelector('table.js-enhanced-table');
          const tbody = table? table.tBodies[0]: null;
          const search = toolbar.querySelector('input.js-search');
          const stage = toolbar.querySelector('select.js-stage');
          const counter = wrapper.querySelector('.js-counter');
          if(!tbody) return;
          const rows = Array.from(tbody.querySelectorAll('tr'));
          function apply(){
            const q = normalize(search? search.value: '');
            const stg = (stage? stage.value: '') || '';
            let visible = 0;
            rows.forEach(tr=>{
              const asunto = normalize(tr.getAttribute('data-asunto')||'');
              const text = normalize(tr.getAttribute('data-text')||tr.textContent||'');
              const rowStage = (tr.getAttribute('data-stage')||'').toLowerCase();
              const matchesAsunto = !q || asunto.includes(q);
              const matchesText = !q || text.includes(q);
              const matchesStage = !stg || stg === 'todos' || rowStage === stg;
              const show = (matchesAsunto || matchesText) && matchesStage;
              tr.style.display = show ? '' : 'none';
              if(show) visible++;
            });
            if(counter){
              const total = rows.length;
              counter.textContent = `Mostrando ${visible} de ${total}`;
            }
          }
          if(search) search.addEventListener('input', apply);
          if(stage) stage.addEventListener('change', apply);
          apply();
        });
      });
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ALCALDÍA</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_home') }}" class="{{ app.request.attributes.get('_route') == 'app_home' ? 'active' : '' }}">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_oficio_index') }}" class="{{ app.request.attributes.get('_route') starts with 'app_oficio' ? 'active' : '' }}">Oficios</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_correspondence_index') }}" class="{{ app.request.attributes.get('_route') starts with 'app_correspondence' ? 'active' : '' }}">Correspondencia</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_circular_index') }}" class="{{ app.request.attributes.get('_route') starts with 'app_circular' ? 'active' : '' }}">Circulares</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_scanner_index') }}" class="{{ app.request.attributes.get('_route') starts with 'app_scanner' ? 'active' : '' }}">Escáner</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="content">
        <header class="topbar">
            <div class="module-title">{% block module_title %}{{ block('title') }}{% endblock %}</div>
            <div class="spacer"></div>
            <div class="user-actions">
                {% if app.user %}
                    <span class="user-name">{{ app.user.userIdentifier ?? app.user.username ?? 'Usuario' }}</span>
                    {% if app.request is defined %}
                        <a class="logout-btn" href="{{ path('app_logout')|default('#') }}" title="Cerrar sesión">Salir</a>
                    {% else %}
                        <a class="logout-btn" href="#" title="Cerrar sesión">Salir</a>
                    {% endif %}
                {% else %}

                {% endif %}
            </div>
        </header>
        <main>
            {% block body %}{% endblock %}
        </main>
        <footer>
            &copy; {{ "now"|date("Y") }} Alcaldía - Todos los derechos reservados
        </footer>
    </div>
</body>
</html>

