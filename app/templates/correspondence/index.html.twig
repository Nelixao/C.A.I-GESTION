{% extends 'base.html.twig' %}

{% block title %}Correspondencia{% endblock %}

{% block stylesheets %}{% endblock %}
{% block body %}
<div class="container-glass">

  <!-- Encabezado + acciones -->
  <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
    <h1 class="page-title">Listado de Correspondencia</h1>

    <div class="glass-actions">
      <a href="{{ path('app_correspondence_export') }}" class="glass-btn success">
        <i class="bi bi-download"></i> Exportar a Excel
      </a>
      <a href="{{ path('app_correspondence_new') }}" class="glass-btn primary">
        <i class="bi bi-plus-circle"></i> Crear nueva
      </a>
    </div>
  </div>

  <div class="js-table-wrapper">
    <!-- Toolbar de filtros -->
    <div class="toolbar">
      <input type="text" class="js-search form-input" placeholder="Buscar en la tabla...">
      <select class="js-stage form-select">
        <option value="todos">Todas las etapas</option>
        <option value="sin-etapa">Sin etapa</option>
      </select>
    </div>

    <!-- Tabla -->
    <div class="table-responsive">
      <table class="table-glass js-enhanced-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>ASUNTO</th>
            <th>MENSAJE</th>
            <th>REMITENTE</th>
            <th>DESTINATARIO</th>
            <th>FECHA</th>
            <th>ARCHIVO</th>
            <th>CREADO POR</th>
            <th>CREADO EL</th>
            <th>ACTUALIZADO EL</th>
            <th class="text-center">ACCIONES</th>
          </tr>
        </thead>
        <tbody>
        {% for correspondence in correspondences %}
          {% set row_text = (correspondence.id ~ ' ' ~ correspondence.subject ~ ' ' ~ correspondence.body ~ ' ' ~ correspondence.sender ~ ' ' ~ correspondence.receiver ~ ' ' ~ (correspondence.date ? correspondence.date|date('Y-m-d H:i') : '') ~ ' ' ~ correspondence.filePath ~ ' ' ~ correspondence.createdBy)|lower %}
          <tr data-stage="sin-etapa" data-text="{{ row_text }}" data-asunto="{{ correspondence.subject|lower }}">
            <td data-label="ID">{{ correspondence.id }}</td>
            <td data-label="Asunto">{{ correspondence.subject|default('—') }}</td>
            <td data-label="Mensaje">{{ correspondence.body|default('—') }}</td>
            <td data-label="Remitente">{{ correspondence.sender|default('—') }}</td>
            <td data-label="Destinatario">{{ correspondence.receiver|default('—') }}</td>
            <td data-label="Fecha">{{ correspondence.date ? correspondence.date|date('Y-m-d H:i') : '' }}</td>
            <td data-label="Archivo">
              {% if correspondence.filePath %}
                <a href="{{ asset(correspondence.filePath) }}" target="_blank" class="file-link">Ver archivo</a>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td data-label="Creado por">{{ correspondence.createdBy|default('—') }}</td>
            <td data-label="Creado el">{{ correspondence.createdAt ? correspondence.createdAt|date('Y-m-d') : '' }}</td>
            <td data-label="Actualizado el">{{ correspondence.updatedAt ? correspondence.updatedAt|date('Y-m-d H:i') : '' }}</td>
            <td data-label="Acciones" class="text-center">
              <a href="{{ path('app_correspondence_show', {'id': correspondence.id}) }}" class="btn btn-outline-primary btn-sm" title="Ver">
                <i class="bi bi-eye"></i>
              </a>
              <a href="{{ path('app_correspondence_edit', {'id': correspondence.id}) }}" class="btn btn-outline-warning btn-sm" title="Editar">
                <i class="bi bi-pencil-square"></i>
              </a>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="11" class="text-center text-muted py-4">SIN INFORMACIÓN</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="js-counter table-counter">&nbsp;</div>
  </div>

  <!-- Botón flotante principal (opcional) -->
  <a href="{{ path('app_correspondence_new') }}" class="glass-btn primary float-btn">
    <i class="bi bi-plus-lg"></i> Crear nueva
  </a>
</div>
{% endblock %}
