{% extends 'base.html.twig' %}

{% block title %}Correspondencia{% endblock %}

{% block stylesheets %}{% endblock %}

{% block body %}
    <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
        <h1 class="page-title">Correspondencia</h1>
        <div style="display:flex; gap:10px;">
            <a href="{{ path('app_correspondence_export') }}" class="create-link" style="background-color:#4caf50;">⬇️ Exportar a Excel</a>
            <a href="{{ path('app_correspondence_new') }}" class="create-link">+ Crear nueva</a>
        </div>
    </div>

    <div class="js-table-wrapper">
      <div class="js-table-toolbar" style="display:flex; gap:10px; margin:10px 0; align-items:center; flex-wrap:wrap;">
          <input type="text" class="js-search" placeholder="Buscar en la tabla..." style="padding:8px 10px; border:1px solid #ddd; border-radius:8px; min-width:240px;">
          <select class="js-stage" style="padding:8px 10px; border:1px solid #ddd; border-radius:8px;">
              <option value="todos">Todas las etapas</option>
              <option value="sin-etapa">Sin etapa</option>
          </select>
      </div>

      <table class="">
        <thead>
            <tr>
                <th>ID</th>
                <th>FECHA</th>
                <th>Mensaje</th>
                <th>Remitente</th>
                <th>Destinatario</th>
                <th>Fecha</th>
                <th>Archivo</th>
                <th>Creado por</th>
                <th>Creado el</th>
                <th>Actualizado el</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
        {% for correspondence in correspondences %}
            {% set row_text = (correspondence.id ~ ' ' ~ correspondence.subject ~ ' ' ~ correspondence.body ~ ' ' ~ correspondence.sender ~ ' ' ~ correspondence.receiver ~ ' ' ~ (correspondence.date ? correspondence.date|date('Y-m-d H:i') : '') ~ ' ' ~ correspondence.filePath ~ ' ' ~ correspondence.createdBy)|lower %}
            <tr data-stage="sin-etapa" data-text="{{ row_text }}" data-asunto="{{ correspondence.subject|lower }}">
                <td>{{ correspondence.id }}</td>
                <td>{{ correspondence.subject }}</td>
                <td>{{ correspondence.body }}</td>
                <td>{{ correspondence.sender }}</td>
                <td>{{ correspondence.receiver }}</td>
                <td>{{ correspondence.date ? correspondence.date|date('Y-m-d H:i') : '' }}</td>
                <td>{{ correspondence.filePath }}</td>
                <td>{{ correspondence.createdBy }}</td>
                <td>{{ correspondence.createdAt ? correspondence.createdAt|date('Y-m-d') : '' }}</td>
                <td>{{ correspondence.updatedAt ? correspondence.updatedAt|date('Y-m-d H:i') : '' }}</td>
                <td>
                    <a href="{{ path('app_correspondence_show', {'id': correspondence.id}) }}" class="btn">Ver</a>
                    <a href="{{ path('app_correspondence_edit', {'id': correspondence.id}) }}" class="btn">Editar</a>
                </td>
            </tr>
        {% else %}
            <tr>
                SIN INFORMACION
            </tr>
        {% endfor %}
        </tbodyç
            </table>
    <div class="js-counter" style="margin-top:8px; color:#555; font-size:0.9rem;">&nbsp;</div>
    </div>

    <a href="{{ path('app_correspondence_new') }}" class="create-link">Crear nuevo</a>
{% endblock %}
